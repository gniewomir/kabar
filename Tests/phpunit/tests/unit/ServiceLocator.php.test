<?php

class ServiceLocatorTests extends WP_UnitTestCase {

    public function setUp() {
        $this->kabar = new \kabar\Kabar();
        \kabar\ServiceLocator::setup($this->kabar);
    }

    /**
     * @dataProvider sharedClasses
     */
    public function testGetClass_ShouldReturnFullClassName($type, $name, $class) {
        $this->assertEquals(
            $class,
            \kabar\ServiceLocator::getClass($type, $name)
        );
    }

    /**
     * @dataProvider sharedClasses
     */
    public function testGet_ShouldReturnSameInstanceAsDIC($type, $name, $class) {
        $this->kabar->maybeShare($class);
        $expected = $this->kabar->create($class);
        $expected->prop = 'expected';
        $tested   = \kabar\ServiceLocator::get($type, $name);
        $this->assertTrue(
            ($expected === $tested)
        );
    }

    /**
     * @dataProvider newableClasses
     */
    public function testGetNew_ShouldReturnNewInstance($type, $name, $class) {
        $expected = \kabar\ServiceLocator::getNew($type, $name);
        $tested  = \kabar\ServiceLocator::getNew($type, $name);
        $this->assertFalse(
            ($expected === $tested)
        );
    }

    /**
     * @dataProvider newableClasses
     */
    public function testGetNew_ShouldReturnCorrectClassInstance($type, $name, $class) {
        $tested  = \kabar\ServiceLocator::getNew($type, $name);
        $this->assertInstanceOf(
            $class,
            $tested
        );
    }

    public function sharedClasses()
    {
        return array(
            array('Module',  'Styles',   'kabar\\Module\\Styles\\Styles'),
            array('Module',  'Scripts',  'kabar\\Module\\Scripts\\Scripts'),
            array('Factory', 'Template', 'kabar\\Factory\\Template\\Template'),
            array('Module',  'Pages',    'kabar\\Module\\Pages\\Pages'),
            array('Module',  'Pages',    'kabar\\Module\\Pages\\Pages'),
            array('Module',  'Pages',    'kabar\\Module\\Pages\\Pages')
        );
    }

    public function newableClasses()
    {
        return array(
            array('Utility', 'Template', 'kabar\\Utility\\Template\\Template', 'test')
        );
    }
}
