<?php

class ServiceLocatorTests extends WP_UnitTestCase {

    /**
     * @dataProvider sharedClasses
     */
    public function testGetClass_ShouldReturnFullClassName($type, $name, $class) {
        $kabar = new \kabar\Kabar();
        \kabar\ServiceLocator::setup($kabar);
        $this->assertEquals(
            $class,
            \kabar\ServiceLocator::getClass($type, $name)
        );
    }

    /**
     * @dataProvider sharedClasses
     */
    public function testGet_ShouldReturnSameInstanceAsDIC($type, $name, $class) {
        $kabar = new \kabar\Kabar();
        \kabar\ServiceLocator::setup($kabar);

        $kabar->maybeShare($class);

        $expected = $kabar->create($class);
        $expected->prop = 'test';
        $tested   = \kabar\ServiceLocator::get($type, $name);

        $this->assertTrue(
            ($kabar === \kabar\ServiceLocator::library())
        );

        $this->assertTrue(
            ($expected === $tested)
        );
    }

    /**
     * @dataProvider newableClasses
     */
    public function testGetNew_ShouldReturnNewInstance($type, $name, $class) {
        $kabar = new \kabar\Kabar();
        \kabar\ServiceLocator::setup($kabar);

        $expected = \kabar\ServiceLocator::getNew($type, $name);
        $expected->prop = 'expected';

        $tested  = \kabar\ServiceLocator::getNew($type, $name);
        $tested->prop = 'tested';

        $this->assertInstanceOf(
            $class,
            $expected
        );

        $this->assertInstanceOf(
            $class,
            $tested
        );

        $this->assertNotEquals(
            $expected->prop,
            $tested->prop
        );

    }

    public function sharedClasses()
    {
        return array(
            array('Module',  'Styles',   'kabar\\Module\\Styles\\Styles'),
            array('Module',  'Scripts',  'kabar\\Module\\Scripts\\Scripts'),
            array('Factory', 'Template', 'kabar\\Factory\\Template\\Template'),
            array('Module',  'Pages',    'kabar\\Module\\Pages\\Pages'),
            array('Module',  'Pages',    'kabar\\Module\\Pages\\Pages'),
            array('Module',  'Pages',    'kabar\\Module\\Pages\\Pages')
        );
    }

    public function newableClasses()
    {
        return array(
            array('Utility', 'Template', 'kabar\\Utility\\Template\\Template', 'test')
        );
    }
}
